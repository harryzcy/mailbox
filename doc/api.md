# API

The current API uses AWS API Gateway, which invokes Lambda functions in `api/*`.

## Endpoint

Dev Endpoint: `https://{api_id}.execute-api.{region}.amazonaws.com/`

The default endpoint is generated by API Gateway. It can be found from your AWS console -> APIs -> \<your-api-name\> -> Settings -> Default Endpoint.

## Methods

### List

Lists emails based on query parameters.

`GET /emails`

Query String Parameters:

- `type`: `inbox` or `draft` or `sent`
- `year`: four digit year (default to current year)
- `month`: one or two digit month (default to current month)
  - e.g. for March, both `3` and `03` are supported
- `order`: `asc` or `desc` (default)
- `nextCursor`: cursor returned by List response (optional)

Note: although `year` and `month` are optional, they must be both provided or both left empty.

Error Response:

| Status Code | Error Message |
| ----------- | ------------- |
| 400 Bad Request | invalid input |
| 429 Too Many Requests | too many requests |

### Get

Get an email given it's messageID.

`GET /emails/{messageID}`

Path Parameters:

- `messageID`: ID of the email message

Error Response:

| Status Code | Error Message |
| ----------- | ------------- |
| 404 Not Found | email not found |
| 429 Too Many Requests | too many requests |

### Trash

Trash an untrashed email given it's messageID.

`POST /emails/{messageID}/trash`

Path Parameters:

- `messageID`: ID of the email message

Note: if the email is already trashed, 400 Bad Request will be returned. If the email is a draft, trash method is not supported.

Error Response:

| Status Code | Error Message |
| ----------- | ------------- |
| 400 Bad Request | email is already trashed |
| 429 Too Many Requests | too many requests |

### Untrash

Untrash an trashed email given it's messageID.

`POST /emails/{messageID}/untrash`

Path Parameters:

- `messageID`: ID of the email message

Note: if the email is not trashed, 400 Bad Request will be returned. If the email is a draft, untrash method is not supported.

Error Response:

| Status Code | Error Message |
| ----------- | ------------- |
| 400 Bad Request | email already not trashed |
| 429 Too Many Requests | too many requests |

### Delete

Permanently delete an trashed email given it's messageID.

`DELETE /emails/{messageID}`

Path Parameters:

- `messageID`: ID of the email message

Note: if the email is not trashed and email type is inbox or sent, 400 Bad Request will be returned.

Error Response:

| Status Code | Error Message |
| ----------- | ------------- |
| 400 Bad Request | email not trashed |
| 429 Too Many Requests | too many requests |

### Create

Create a draft email.

`POST /emails`

Request Body (JSON formatted):

| Field | Type | Description |
| ----- | ---- | ----------- |
| `subject` | string | Subject of email |
| `from` | string array | From addresses |
| `to` | string array | To addresses |
| `cc` | string array | Cc addresses |
| `bcc` | string array | Bcc addresses |
| `replayTo` | string array | ReplayTo addresses |
| `text` | string | email content in text |
| `html` | string | email content in HTML |
| `generateText`[^1] | string (optional) | `on`, `off`, or `auto` (default) |
| `send` | boolean (optional) | send email immediately without creating draft (default `false`) |

Response:

| Field | Type | Description |
| ----- | ---- | ----------- |
| `messageID` | string | ID of created draft email |
| `type` | string | `draft` or `sent` |
| `subject` | string | Subject of email |
| `from` | string array | From addresses |
| `to` | string array | To addresses |
| `cc` | string array | Cc addresses |
| `bcc` | string array | Bcc addresses |
| `replayTo` | string array | ReplayTo addresses |
| `text` | string | email content in text |
| `html` | string | email content in HTML |

Error Response:

| Status Code | Error Message |
| ----------- | ------------- |
| 400 Bad Request | invalid input |
| 429 Too Many Requests | too many requests |

### Save

Save a draft email, which is identified by messageID returned from 'Create' operation.

Note: this operation replaces the entire draft email,
so all fields must be supplied to it will be removed.

`PUT /emails/{messageID}`

Path Parameters:

- `messageID`: ID of the email message

Request Body (JSON formatted):

| Field | Type | Description |
| ----- | ---- | ----------- |
| `subject` | string | Subject of email |
| `from` | string array | From addresses |
| `to` | string array | To addresses |
| `cc` | string array | Cc addresses |
| `bcc` | string array | Bcc addresses |
| `replayTo` | string array | ReplayTo addresses |
| `text` | string | email content in text |
| `html` | string | email content in HTML |
| `generateText`[^1] | string (optional) | `on`, `off`, or `auto` (default) |
| `send` | boolean (optional) | send email immediately without creating draft (default `false`) |

Response:

| Field | Type | Description |
| ----- | ---- | ----------- |
| `messageID` | string | ID of saved draft email |
| `type` | string | `draft` or `sent` |
| `subject` | string | Subject of email |
| `from` | string array | From addresses |
| `to` | string array | To addresses |
| `cc` | string array | Cc addresses |
| `bcc` | string array | Bcc addresses |
| `replayTo` | string array | ReplayTo addresses |
| `text` | string | email content in text |
| `html` | string | email content in HTML |

Error Response:

| Status Code | Error Message |
| ----------- | ------------- |
| 400 Bad Request | invalid input |
| 429 Too Many Requests | too many requests |

### Send

Send a draft email, which is identified by messageID.

`POST /emails/{messageID}/send`

Path Parameters:

- `messageID`: ID of the email message

Error Response:

| Status Code | Error Message |
| ----------- | ------------- |
| 429 Too Many Requests | too many requests |

---

[^1]: Field `generateText`:
  If `on`, text is always generated from HTML.
  If `off`, text is never generated.
  If `auto` (default), text is generated if text is empty.
